## 2026-01-24: Schema Updates (schema-strategy, schema-reader-result)

Files changed:
- packages/web-page-parser/src/schema.ts
- packages/web-page-parser/src/index.ts

Changes:
- Added ExtractionStrategy schema: Schema.NullOr(Schema.Literal("readability", "selector"))
- Updated ReaderResult to include metadata (nullable) and strategy fields
- Exported ExtractionStrategy from index.ts

Decisions:
- ReaderResult.metadata is NullOr(PageMetadata) - null when fetch fails, present when fetch succeeds
- ExtractionStrategy uses NullOr pattern - null means no extraction strategy succeeded

Notes:
- handlers.ts now has type errors - expected, will be fixed in handlers-update item
- web-page-parser package typechecks independently

## 2026-01-24: Database Schema (db-schema)

Files changed:
- apps/worker/src/features/web-page-parser/drizzle/drizzle.schema.ts
- apps/worker/src/features/web-page-parser/drizzle/migrations/0002_round_hobgoblin.sql (new)
- apps/worker/src/features/web-page-parser/drizzle/migrations/migrations.js (auto-updated)

Changes:
- Added `strategy` text column for 'readability' | 'selector' | null
- Added `metaTitle` text column (snake_case: meta_title)
- Added `metaDescription` text column (snake_case: meta_description)
- Generated migration via drizzle-kit

Notes:
- handlers.ts type errors still present - expected, fixed in handlers-update item

## 2026-01-24: Extract Metadata (extract-metadata)

Files changed:
- apps/worker/src/features/web-page-parser/extractMetadata.ts (new)

Changes:
- Pure function extractMetadata(doc: Document) => PageMetadata
- Uses getMetaContent helper with selector priority
- Title: og:title > title tag, fallback "Untitled"
- Description: og:description > meta[name="description"]

Notes:
- handlers.ts type errors still present - expected, fixed in handlers-update item

## 2026-01-24: Extract Content (extract-content)

Files changed:
- apps/worker/src/features/web-page-parser/extractContent.ts (new)

Changes:
- Pure function extractContent(doc, url, options?) => ContentResult
- Tries Readability first with isProbablyReaderable check
- Falls back to selector-based extraction (article, main, [role="main"], etc.)
- MIN_CONTENT_LENGTH = 500 for selector fallback
- Image URLs rewritten via regex for both strategies
- Exports ContentResult type

Decisions:
- Regex-based image rewriting (vs linkedom reparsing) for simplicity
- preserveCodeBlockNewlines ported from fetchReaderContent.ts

Notes:
- handlers.ts type errors still present - expected, fixed in handlers-update item

## 2026-01-24: Extract Page (extract-page)

Files changed:
- apps/worker/src/features/web-page-parser/extractPage.ts (new)

Changes:
- Pure function extractPage(html, baseUrl) => ExtractedPage
- Uses linkedom parseHTML internally
- Composes extractMetadata + extractContent
- Returns { metadata, content, strategy }

Notes:
- handlers.ts type errors still present - expected, fixed in handlers-update item
