## 2026-01-17: Spec Creation

**Files created:**
- `specs/reader-mode/instructions.md`
- `specs/reader-mode/requirements.md`
- `specs/reader-mode/design.md`
- `specs/reader-mode/plan.md`
- `specs/reader-mode/prd.json`
- `specs/README.md` (updated with reader-mode entry)

**Key decisions:**
- Extend existing WebPageParser DO (not create new DO)
- Use `@mozilla/readability` + `linkedom/worker` for content extraction
- Keep `fetchlog` and `reader_content` as separate tables (simpler, no migration)
- Images proxied via `/api/proxy-image?url=...` to avoid CORS/tracking
- Same 24h cache TTL as existing metadata
- Tests integrated into each implementation task (not separate final step)

**Architecture:**
- New RPC: `getReaderContent({ forceFetch?: boolean })` → `ReaderResult`
- New table: `reader_content` with extracted article data
- New route: `GET /api/proxy-image?url=<encoded>` for image proxying
- New files: `fetchReaderContent.ts`, `proxyImage.ts`

**Requirements summary:**
- 15 functional requirements (FR-1 to FR-5)
- 11 non-functional requirements (NFR-1 to NFR-4)
- 7 acceptance tests

## 2026-01-18: Task 1 - Dependencies

**Completed:**
- Added `linkedom` and `@mozilla/readability` to worker dependencies
- Added `@types/mozilla__readability` to worker devDependencies
- All packages use workspace catalog versions

**Verification:**
- `pnpm install` ✓
- `turbo run typecheck` ✓
- Packages in `apps/worker/package.json` ✓

## 2026-01-18: Task 2 - Schema

**Files changed:**
- `packages/web-page-parser/src/schema.ts` - added ReaderContent, ReaderResult
- `packages/web-page-parser/src/index.ts` - export new types

**Verification:**
- `turbo run typecheck` ✓

## 2026-01-18: Task 3 - TaggedErrors

**Files changed:**
- `packages/web-page-parser/src/errors.ts` - new file with 6 TaggedErrors
- `packages/web-page-parser/src/index.ts` - export all errors

**Errors added:**
- FetchTimeoutError, FetchHttpError, FetchNetworkError
- NotReadableError, ParseError, InvalidProtocolError

**Verification:**
- `turbo run typecheck` ✓

## 2026-01-18: Task 4 - RPC Definition

**Files changed:**
- `packages/web-page-parser/src/rpc.ts` - added getReaderContent RPC
- `apps/worker/src/features/web-page-parser/handlers.ts` - added stub handler

**Key decisions:**
- Added stub handler returning `{readable: false, content: null, error: "Not implemented"}` for typecheck to pass
- Spellbook.make requires all RPC handlers to be present

**Verification:**
- `turbo run typecheck` ✓
- `pnpm --filter worker run test` ✓
