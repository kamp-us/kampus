type ApiKey {
  key: String!
  name: String!
}

type CreateStoryPayload {
  story: Story
  storyEdge: StoryEdge
}

type CreateTagPayload {
  error: TagError
  tag: Tag
}

type DeleteStoryPayload {
  deletedStoryId: ID
  error: StoryNotFoundError
  success: Boolean!
}

type DeleteTagPayload {
  deletedTagId: ID
  error: TagNotFoundError
  success: Boolean!
}

type InvalidTagNameError {
  code: String!
  message: String!
  tagName: String!
}

type Library implements Node {
  id: ID!
  stories(after: String, first: Int): StoryConnection!
  storiesByTag(after: String, first: Int, tagName: String!): StoryConnection!
  story(id: ID!): Story
  tags: [Tag!]!
  webPage(url: String!): WebPage
}

type Mutation {
  bootstrap(email: String!, name: String!, password: String!): User
  createApiKey(name: String!): ApiKey
  createStory(description: String, tagIds: [String!], title: String!, url: String!): CreateStoryPayload!
  createTag(color: String!, name: String!): CreateTagPayload!
  deleteStory(id: ID!): DeleteStoryPayload!
  deleteTag(id: ID!): DeleteTagPayload!
  signIn(email: String!, password: String!): SignInResponse
  updateStory(description: String, id: ID!, tagIds: [ID!], title: String): UpdateStoryPayload!
  updateTag(color: String, id: ID!, name: String): UpdateTagPayload!
}

interface Node {
  id: ID!
}

type PageInfo {
  endCursor: String
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
}

type Query {
  fetchUrlMetadata(url: String!): UrlMetadata
  me: User
  node(id: String!): Node
}

type SignInResponse {
  token: String!
  user: User!
}

type Story implements Node {
  createdAt: String!
  description: String
  id: ID!
  tags: [Tag!]!
  title: String!
  url: String!
}

type StoryConnection {
  edges: [StoryEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type StoryEdge {
  cursor: String!
  node: Story!
}

type StoryNotFoundError {
  code: String!
  message: String!
  storyId: String!
}

type Tag implements Node {
  color: String!
  id: ID!
  name: String!
  stories(after: String, first: Int): StoryConnection!
}

union TagError = InvalidTagNameError | TagNameExistsError

type TagNameExistsError {
  code: String!
  message: String!
  tagName: String!
}

type TagNotFoundError {
  code: String!
  message: String!
  tagId: String!
}

type UpdateStoryPayload {
  error: StoryNotFoundError
  story: Story
}

union UpdateTagError = InvalidTagNameError | TagNameExistsError | TagNotFoundError

type UpdateTagPayload {
  error: UpdateTagError
  tag: Tag
}

type UrlMetadata {
  description: String
  error: String
  title: String
}

type User {
  email: String!
  id: String!
  library: Library!
  name: String
}

type WebPage {
  description: String
  error: String
  title: String
  url: String!
}